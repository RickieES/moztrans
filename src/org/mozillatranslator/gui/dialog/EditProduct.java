/*
 * The contents of this file are subject to the Mozilla Public
 * License Version 1.1 (the "License"); you may not use this file
 *  except in compliance with the License. You may obtain a copy of
 * the License at http://www.mozilla.org/MPL/
 *
 * Software distributed under the License is distributed on an "AS
 * IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
 * implied. See the License for the specific language governing
 * rights and limitations under the License.
 *
 * The Original Code is MozillaTranslator (Mozilla Localization Tool)
 *
 * The Initial Developer of the Original Code is Henrik Lynggaard Hansen
 *
 * Portions created by Henrik Lynggard Hansen are
 * Copyright (C) Henrik Lynggaard Hansen.
 * All Rights Reserved.
 *
 * Contributor(s):
 * Henrik Lynggaard Hansen (Initial Code)
 *
 */

package org.mozillatranslator.gui.dialog;

import java.awt.CardLayout;
import java.io.File;
import javax.swing.JDialog;
import javax.swing.JFileChooser;
import javax.swing.JList;
import javax.swing.JOptionPane;
import org.mozillatranslator.datamodel.*;
import org.mozillatranslator.io.common.FileUtils;
import org.mozillatranslator.kernel.Kernel;
import org.mozillatranslator.kernel.Settings;
import org.mozillatranslator.util.GuiTools;

/**
 *
 * @author  Henrik Lynggaard
 * @version 1.0
 */
public class EditProduct extends JDialog {
    private Product prod;
    
    /** Creates new form ManageProducts
     * @param p the product to edit
     */
    public EditProduct(Product p) {
        super(Kernel.mainWindow, "Edit Product", true);
        prod = p;
        initComponents();
        JDialogHelper.setupOKCancelHotkeys(this, okButton, cancelButton);
        GuiTools.placeFrameAtCenter(this);
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        productTypeRG = new javax.swing.ButtonGroup();
        productPanel = new javax.swing.JPanel();
        basicPanel = new javax.swing.JPanel();
        nameLabel = new javax.swing.JLabel();
        basicNameField = new javax.swing.JTextField();
        typeJarRadio = new javax.swing.JRadioButton();
        typeCvsRadio = new javax.swing.JRadioButton();
        prodPropPanel = new javax.swing.JPanel();
        jarPanel = new javax.swing.JPanel();
        neutralJarfileLabel = new javax.swing.JLabel();
        neutralJarfileField = new javax.swing.JTextField();
        neutralJarfileFilechose = new javax.swing.JButton();
        platformPlatformLabel = new javax.swing.JLabel();
        platformListScroll = new javax.swing.JScrollPane();
        platform_platformList = new JList(prod.platformArray());
        platformAddButton = new javax.swing.JButton();
        platformEditButton = new javax.swing.JButton();
        platformRemoveButton = new javax.swing.JButton();
        regionJarLabel = new javax.swing.JLabel();
        regionJarField = new javax.swing.JTextField();
        regionRegioncChoose = new javax.swing.JButton();
        customFilesLabel = new javax.swing.JLabel();
        customListScroll = new javax.swing.JScrollPane();
        custom_customList = new JList(prod.customArray());
        customAddButton = new javax.swing.JButton();
        customEditButton = new javax.swing.JButton();
        customRemoveButton = new javax.swing.JButton();
        justLocaleAbCDCheck = new javax.swing.JCheckBox();
        cvsPanel = new javax.swing.JPanel();
        cvsImportOriginalLabel = new javax.swing.JLabel();
        cvsImpExpTranslationLabel = new javax.swing.JLabel();
        cvsImportOriginalField = new javax.swing.JTextField();
        cvsImpExpTranslationField = new javax.swing.JTextField();
        cvsImportOriginalFilechoose = new javax.swing.JButton();
        cvsImpExpTranslationFilechoose = new javax.swing.JButton();
        usingRepoBaseDir = new javax.swing.JLabel();
        repoBaseDirField = new javax.swing.JTextField();
        buttonPanel = new javax.swing.JPanel();
        okButton = new javax.swing.JButton();
        cancelButton = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DO_NOTHING_ON_CLOSE);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                windowClose(evt);
            }
        });

        productPanel.setLayout(new java.awt.GridBagLayout());

        basicPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "General Information", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Dialog", 0, 10))); // NOI18N
        basicPanel.setMinimumSize(new java.awt.Dimension(186, 96));
        basicPanel.setPreferredSize(new java.awt.Dimension(441, 96));
        basicPanel.setLayout(new java.awt.GridBagLayout());

        nameLabel.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        nameLabel.setLabelFor(basicNameField);
        nameLabel.setText("Name");
        nameLabel.setMaximumSize(new java.awt.Dimension(2147483647, 2147483647));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        basicPanel.add(nameLabel, gridBagConstraints);

        basicNameField.setColumns(30);
        basicNameField.setText("name of product");
        basicNameField.setMinimumSize(new java.awt.Dimension(40, 27));
        basicNameField.setPreferredSize(new java.awt.Dimension(200, 27));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        basicPanel.add(basicNameField, gridBagConstraints);

        productTypeRG.add(typeJarRadio);
        typeJarRadio.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        typeJarRadio.setMnemonic('b');
        typeJarRadio.setText("JAR based");
        typeJarRadio.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        typeJarRadio.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                typeJarRadioActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        basicPanel.add(typeJarRadio, gridBagConstraints);

        productTypeRG.add(typeCvsRadio);
        typeCvsRadio.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        typeCvsRadio.setMnemonic('V');
        typeCvsRadio.setSelected(true);
        typeCvsRadio.setText("SCM based");
        typeCvsRadio.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        typeCvsRadio.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                typeCvsRadioActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        basicPanel.add(typeCvsRadio, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = java.awt.GridBagConstraints.REMAINDER;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        productPanel.add(basicPanel, gridBagConstraints);

        prodPropPanel.setMinimumSize(new java.awt.Dimension(441, 304));
        prodPropPanel.setPreferredSize(new java.awt.Dimension(441, 304));
        prodPropPanel.setLayout(new java.awt.CardLayout());

        jarPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "JAR info panel", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Dialog", 0, 10))); // NOI18N
        jarPanel.setPreferredSize(new java.awt.Dimension(441, 285));
        jarPanel.setLayout(new java.awt.GridBagLayout());

        neutralJarfileLabel.setDisplayedMnemonic('N');
        neutralJarfileLabel.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        neutralJarfileLabel.setLabelFor(neutralJarfileField);
        neutralJarfileLabel.setText("Platform Neutral JAR file");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(neutralJarfileLabel, gridBagConstraints);

        neutralJarfileField.setColumns(30);
        neutralJarfileField.setText("jTextField1");
        neutralJarfileField.setMinimumSize(new java.awt.Dimension(40, 27));
        neutralJarfileField.setPreferredSize(new java.awt.Dimension(200, 27));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(neutralJarfileField, gridBagConstraints);

        neutralJarfileFilechose.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        neutralJarfileFilechose.setText("Choose");
        neutralJarfileFilechose.setMaximumSize(new java.awt.Dimension(80, 25));
        neutralJarfileFilechose.setMinimumSize(new java.awt.Dimension(80, 25));
        neutralJarfileFilechose.setPreferredSize(new java.awt.Dimension(80, 25));
        neutralJarfileFilechose.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                neutralJarfileFilechosePressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(neutralJarfileFilechose, gridBagConstraints);

        platformPlatformLabel.setDisplayedMnemonic('P');
        platformPlatformLabel.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        platformPlatformLabel.setLabelFor(platform_platformList);
        platformPlatformLabel.setText("Platform JAR files");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(platformPlatformLabel, gridBagConstraints);

        platformListScroll.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        platformListScroll.setPreferredSize(new java.awt.Dimension(200, 86));

        platform_platformList.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        platform_platformList.setPrototypeCellValue("Obscure unknown platform that is not mine");
        platformListScroll.setViewportView(platform_platformList);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.gridheight = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(platformListScroll, gridBagConstraints);

        platformAddButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        platformAddButton.setText("Add");
        platformAddButton.setMaximumSize(new java.awt.Dimension(80, 25));
        platformAddButton.setMinimumSize(new java.awt.Dimension(80, 25));
        platformAddButton.setPreferredSize(new java.awt.Dimension(80, 25));
        platformAddButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                platformAddButtonPressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(platformAddButton, gridBagConstraints);

        platformEditButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        platformEditButton.setText("Edit");
        platformEditButton.setMaximumSize(new java.awt.Dimension(80, 25));
        platformEditButton.setMinimumSize(new java.awt.Dimension(80, 25));
        platformEditButton.setPreferredSize(new java.awt.Dimension(80, 25));
        platformEditButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                platformEditButtonPressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(platformEditButton, gridBagConstraints);

        platformRemoveButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        platformRemoveButton.setText("Remove");
        platformRemoveButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                platformRemoveButtonPressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(platformRemoveButton, gridBagConstraints);

        regionJarLabel.setDisplayedMnemonic('R');
        regionJarLabel.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        regionJarLabel.setLabelFor(regionJarField);
        regionJarLabel.setText("Regional JAR file");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        jarPanel.add(regionJarLabel, gridBagConstraints);

        regionJarField.setColumns(30);
        regionJarField.setText("regional jar file");
        regionJarField.setMinimumSize(new java.awt.Dimension(40, 27));
        regionJarField.setPreferredSize(new java.awt.Dimension(200, 27));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        jarPanel.add(regionJarField, gridBagConstraints);

        regionRegioncChoose.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        regionRegioncChoose.setText("Choose");
        regionRegioncChoose.setMaximumSize(new java.awt.Dimension(80, 25));
        regionRegioncChoose.setMinimumSize(new java.awt.Dimension(80, 25));
        regionRegioncChoose.setPreferredSize(new java.awt.Dimension(80, 25));
        regionRegioncChoose.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                regionChoosePressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(regionRegioncChoose, gridBagConstraints);

        customFilesLabel.setDisplayedMnemonic('u');
        customFilesLabel.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        customFilesLabel.setLabelFor(custom_customList);
        customFilesLabel.setText("Custom files");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(customFilesLabel, gridBagConstraints);

        customListScroll.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        customListScroll.setPreferredSize(new java.awt.Dimension(200, 86));

        custom_customList.setPrototypeCellValue("Obscure unknown platform that is not mine");
        customListScroll.setViewportView(custom_customList);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.gridheight = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(customListScroll, gridBagConstraints);

        customAddButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        customAddButton.setText("Add");
        customAddButton.setMaximumSize(new java.awt.Dimension(80, 25));
        customAddButton.setMinimumSize(new java.awt.Dimension(80, 25));
        customAddButton.setPreferredSize(new java.awt.Dimension(80, 25));
        customAddButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                customAddButtonPressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(customAddButton, gridBagConstraints);

        customEditButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        customEditButton.setText("Edit");
        customEditButton.setMaximumSize(new java.awt.Dimension(80, 25));
        customEditButton.setMinimumSize(new java.awt.Dimension(80, 25));
        customEditButton.setPreferredSize(new java.awt.Dimension(80, 25));
        customEditButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                customEditButtonPressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 7;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(customEditButton, gridBagConstraints);

        customRemoveButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        customRemoveButton.setText("Remove");
        customRemoveButton.setMaximumSize(new java.awt.Dimension(80, 25));
        customRemoveButton.setMinimumSize(new java.awt.Dimension(80, 25));
        customRemoveButton.setPreferredSize(new java.awt.Dimension(80, 25));
        customRemoveButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                customRemoveButtonPressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 8;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(customRemoveButton, gridBagConstraints);

        justLocaleAbCDCheck.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        justLocaleAbCDCheck.setMnemonic('C');
        justLocaleAbCDCheck.setText("Consider files just under /locale/ab-CD/");
        justLocaleAbCDCheck.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jarPanel.add(justLocaleAbCDCheck, gridBagConstraints);

        prodPropPanel.add(jarPanel, "jarPanel");

        cvsPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "CVS info panel", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Dialog", 0, 10))); // NOI18N
        cvsPanel.setMaximumSize(new java.awt.Dimension(800, 400));
        cvsPanel.setMinimumSize(new java.awt.Dimension(200, 120));
        cvsPanel.setPreferredSize(new java.awt.Dimension(441, 120));
        cvsPanel.setLayout(new java.awt.GridBagLayout());

        cvsImportOriginalLabel.setDisplayedMnemonic('I');
        cvsImportOriginalLabel.setLabelFor(cvsImportOriginalField);
        cvsImportOriginalLabel.setText("Import original");
        cvsImportOriginalLabel.setToolTipText("The path to be proposed when invoking Import -> CVS Directory");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        cvsPanel.add(cvsImportOriginalLabel, gridBagConstraints);

        cvsImpExpTranslationLabel.setDisplayedMnemonic('m');
        cvsImpExpTranslationLabel.setLabelFor(cvsImpExpTranslationField);
        cvsImpExpTranslationLabel.setText("Import/Export translation");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        cvsPanel.add(cvsImpExpTranslationLabel, gridBagConstraints);

        cvsImportOriginalField.setText("/path/to/import");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        cvsPanel.add(cvsImportOriginalField, gridBagConstraints);

        cvsImpExpTranslationField.setText("/path/to/export");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        cvsPanel.add(cvsImpExpTranslationField, gridBagConstraints);

        cvsImportOriginalFilechoose.setMnemonic('C');
        cvsImportOriginalFilechoose.setText("Choose");
        cvsImportOriginalFilechoose.setMaximumSize(new java.awt.Dimension(80, 25));
        cvsImportOriginalFilechoose.setMinimumSize(new java.awt.Dimension(80, 25));
        cvsImportOriginalFilechoose.setPreferredSize(new java.awt.Dimension(80, 25));
        cvsImportOriginalFilechoose.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cvsPathChooseActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        cvsPanel.add(cvsImportOriginalFilechoose, gridBagConstraints);

        cvsImpExpTranslationFilechoose.setMnemonic('h');
        cvsImpExpTranslationFilechoose.setText("Choose");
        cvsImpExpTranslationFilechoose.setMaximumSize(new java.awt.Dimension(80, 25));
        cvsImpExpTranslationFilechoose.setMinimumSize(new java.awt.Dimension(80, 25));
        cvsImpExpTranslationFilechoose.setPreferredSize(new java.awt.Dimension(80, 25));
        cvsImpExpTranslationFilechoose.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cvsPathChooseActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        cvsPanel.add(cvsImpExpTranslationFilechoose, gridBagConstraints);

        usingRepoBaseDir.setText("Repositories base dir will be used");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        cvsPanel.add(usingRepoBaseDir, gridBagConstraints);

        repoBaseDirField.setEditable(false);
        repoBaseDirField.setEnabled(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        cvsPanel.add(repoBaseDirField, gridBagConstraints);

        prodPropPanel.add(cvsPanel, "cvsPanel");

        productPanel.add(prodPropPanel, new java.awt.GridBagConstraints());

        getContentPane().add(productPanel, java.awt.BorderLayout.CENTER);

        okButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        okButton.setText("OK");
        okButton.setMaximumSize(new java.awt.Dimension(80, 25));
        okButton.setMinimumSize(new java.awt.Dimension(80, 25));
        okButton.setPreferredSize(new java.awt.Dimension(80, 25));
        okButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                okButtonPressed(evt);
            }
        });
        buttonPanel.add(okButton);

        cancelButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        cancelButton.setText("Cancel");
        cancelButton.setMaximumSize(new java.awt.Dimension(80, 25));
        cancelButton.setMinimumSize(new java.awt.Dimension(80, 25));
        cancelButton.setPreferredSize(new java.awt.Dimension(80, 25));
        cancelButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelButtonPressed(evt);
            }
        });
        buttonPanel.add(cancelButton);

        getContentPane().add(buttonPanel, java.awt.BorderLayout.SOUTH);

        pack();
    }// </editor-fold>//GEN-END:initComponents
    
    private void typeCvsRadioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_typeCvsRadioActionPerformed
        enableJarPanelFields(false);
    }//GEN-LAST:event_typeCvsRadioActionPerformed
    
    private void typeJarRadioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_typeJarRadioActionPerformed
        enableJarPanelFields(true);
    }//GEN-LAST:event_typeJarRadioActionPerformed
            
    private void cvsPathChooseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cvsPathChooseActionPerformed
        File defaultFile;
        File f;
        JFileChooser chooser;
        int result;
        boolean isImportOriginal;

        isImportOriginal = (evt.getSource() == cvsImportOriginalFilechoose);

        defaultFile = new File((isImportOriginal) ? cvsImportOriginalField.getText() : cvsImpExpTranslationField.getText());

        if (defaultFile.isDirectory()) {
            f = defaultFile;
        } else {
            defaultFile = new File(repoBaseDirField.getText() + File.separator
                    + ((isImportOriginal) ? cvsImportOriginalField.getText() : cvsImpExpTranslationField.getText()));
            if (defaultFile.isDirectory()) {
                f = defaultFile;
            } else {
                try {
                    f = new File(FileUtils.getFullRepoDir(prod.getCVSImportOriginalPath()));
                } catch (java.lang.NullPointerException e) {
                    f = new File("");
                }
            }
        }
        
        chooser = new JFileChooser(f);
        chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
        chooser.setDialogTitle((isImportOriginal) ? "Select directory to import from"
                                                  : "Select directory to import from / export to");
        
        result = chooser.showDialog(this, "Choose directory");
        if (result == JFileChooser.APPROVE_OPTION) {
            int repoBaseDirLength = repoBaseDirField.getText().length();
            String chosenPath = chooser.getSelectedFile().getAbsolutePath();
            String definitivePath;
            if (chosenPath.substring(0, repoBaseDirLength).equalsIgnoreCase(repoBaseDirField.getText())) {
                definitivePath = chosenPath.substring(repoBaseDirLength);
            } else {
                definitivePath = chosenPath;
            }

            if (isImportOriginal) {
                cvsImportOriginalField.setText(definitivePath);
            } else {
                cvsImpExpTranslationField.setText(definitivePath);
            }
        }
    }//GEN-LAST:event_cvsPathChooseActionPerformed
    
    private void customRemoveButtonPressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_customRemoveButtonPressed
        GenericFile cfile = (GenericFile) custom_customList.getSelectedValue();
        if (cfile != null) {
            int result = JOptionPane.showConfirmDialog(this, "Really remove: " +
                    cfile, "Remove Custom file", JOptionPane.OK_CANCEL_OPTION,
                    JOptionPane.WARNING_MESSAGE);
            
            if (result == JOptionPane.OK_OPTION) {
                cusCon.removeChild(cfile);
                custom_customList.setListData(cusCon.toArray());
            }
        }
    }//GEN-LAST:event_customRemoveButtonPressed
    
    private void customEditButtonPressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_customEditButtonPressed
        GenericFile cfile = (GenericFile) custom_customList.getSelectedValue();
        if (cfile != null) {
            EditCustomFileDialog ecf = new EditCustomFileDialog(cfile);
            
            boolean efcOkay = ecf.showDialog();
            if (efcOkay) {
                cfile = FileFactory.changeType(cfile);
                cusCon.addChild(cfile);
                custom_customList.setListData(cusCon.toArray());
            }
        }
    }//GEN-LAST:event_customEditButtonPressed
    
    private void customAddButtonPressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_customAddButtonPressed
        GenericFile cfile = FileFactory.createFile("", cusCon);
        
        EditCustomFileDialog ecf = new EditCustomFileDialog(cfile);
        
        if (ecf.showDialog()) {
            cfile = FileFactory.changeType(cfile);
            cusCon.addChild(cfile);
            custom_customList.setListData(cusCon.toArray());
        }
    }//GEN-LAST:event_customAddButtonPressed
    
    private void regionChoosePressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_regionChoosePressed
        File defaultFile;
        JFileChooser chooser;
        int result;
        
        defaultFile = new File(regionJarField.getText());
        File f = defaultFile.isFile() ? defaultFile :
            new File(Kernel.settings.getString(
                Settings.GUI_IMPORT_FILE_CHOOSER_PATH));
        chooser = new JFileChooser(f);
        chooser.setFileSelectionMode(JFileChooser.FILES_ONLY);
        chooser.setDialogTitle("Select Jar file to mount as region");
        chooser.setSelectedFile(f);
        
        result = chooser.showDialog(this, "Choose");
        if (result == JFileChooser.APPROVE_OPTION) {
            Kernel.settings.setString(Settings.GUI_IMPORT_FILE_CHOOSER_PATH,
                    chooser.getCurrentDirectory().getAbsolutePath());
            defaultFile = chooser.getSelectedFile();
            regionJarField.setText(defaultFile.toString());
        }
        
    }//GEN-LAST:event_regionChoosePressed
    
    private void platformRemoveButtonPressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_platformRemoveButtonPressed
        Platform plat = (Platform) platform_platformList.getSelectedValue();
        if (plat != null) {
            int result = JOptionPane.showConfirmDialog(this, "Really remove: " +
                    plat, "Remove platform", JOptionPane.OK_CANCEL_OPTION,
                    JOptionPane.WARNING_MESSAGE);
            
            if (result == JOptionPane.OK_OPTION) {
                prod.removeChild(plat);
                platform_platformList.setListData(prod.platformArray());
            }
        }
    }//GEN-LAST:event_platformRemoveButtonPressed
    
    private void platformEditButtonPressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_platformEditButtonPressed
        Platform plat = (Platform) platform_platformList.getSelectedValue();
        if (plat != null) {
            EditPlatformDialog ep = new EditPlatformDialog(plat);
            
            ep.showDialog();
        }
        
    }//GEN-LAST:event_platformEditButtonPressed
    
    private void platformAddButtonPressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_platformAddButtonPressed
        Platform plat = new Platform("", prod, ProductChild.TYPE_OTHER);
        EditPlatformDialog ep = new EditPlatformDialog(plat);
        
        if (ep.showDialog()) {
            prod.addChild(plat);
            platform_platformList.setListData(prod.platformArray());
        }
    }//GEN-LAST:event_platformAddButtonPressed
    
    private void windowClose(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_windowClose
        okay = false;
        setVisible(false);
    }//GEN-LAST:event_windowClose
    
    private void cancelButtonPressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelButtonPressed
        okay = false;
        setVisible(false);
    }//GEN-LAST:event_cancelButtonPressed
    
     private void okButtonPressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_okButtonPressed
         if (this.validateFields()) {
            okay = true;
            setVisible(false);
         }
     }//GEN-LAST:event_okButtonPressed
     
     private void neutralJarfileFilechosePressed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_neutralJarfileFilechosePressed
         File defaultFile;
         JFileChooser chooser;
         int result;
         
         defaultFile = new File(neutralJarfileField.getText());
         File f = defaultFile.isFile() ? defaultFile :
             new File(Kernel.settings.getString(
                 Settings.GUI_IMPORT_FILE_CHOOSER_PATH));
         chooser = new JFileChooser(f);
         chooser.setFileSelectionMode(JFileChooser.FILES_ONLY);
         chooser.setDialogTitle("Select Jar file to mount as platform neutral");
         chooser.setSelectedFile(defaultFile);
         
         result = chooser.showDialog(this, "Choose");
         if (result == JFileChooser.APPROVE_OPTION) {
             Kernel.settings.setString(Settings.GUI_IMPORT_FILE_CHOOSER_PATH,
                     chooser.getCurrentDirectory().getAbsolutePath());
             defaultFile = chooser.getSelectedFile();
             neutralJarfileField.setText(defaultFile.toString());
         }
    }//GEN-LAST:event_neutralJarfileFilechosePressed
     
    private void enableJarPanelFields(boolean enableFields) {
        // Enable/disable JAR info panel and its associated fields and buttons
        
        CardLayout cl = (CardLayout) (prodPropPanel.getLayout());
        if (enableFields) {
            cl.show(prodPropPanel, "jarPanel");
        } else {
            cl.show(prodPropPanel, "cvsPanel");
        }
        jarPanel.setEnabled(enableFields);
        neutralJarfileField.setEnabled(enableFields);
        neutralJarfileFilechose.setEnabled(enableFields);
        platformAddButton.setEnabled(enableFields);
        platformEditButton.setEnabled(enableFields);
        platformListScroll.setEnabled(enableFields);
        platformRemoveButton.setEnabled(enableFields);
        platform_platformList.setEnabled(enableFields);
        regionJarField.setEnabled(enableFields);
        regionRegioncChoose.setEnabled(enableFields);
        customAddButton.setEnabled(enableFields);
        customEditButton.setEnabled(enableFields);
        customListScroll.setEnabled(enableFields);
        customRemoveButton.setEnabled(enableFields);
        custom_customList.setEnabled(enableFields);
        
        enableFields = !enableFields;
        
        // Disable/enable CVS info panel and its associated fields and buttons
        cvsPanel.setEnabled(enableFields);
        cvsImportOriginalField.setEnabled(enableFields);
        cvsImportOriginalFilechoose.setEnabled(enableFields);
        cvsImpExpTranslationField.setEnabled(enableFields);
        cvsImpExpTranslationFilechoose.setEnabled(enableFields);
    }
     
    public boolean showDialog() {
        boolean isJarBased = ((prod.getNeutralPlatform().getJarFile() != null) &&
                              (prod.getNeutralPlatform().getJarFile().length() > 0));
        okay = false;
        
        // Setup Dialog
        basicNameField.setText(prod.getName());
        neutralJarfileField.setText(prod.getNeutralPlatform().getJarFile());
        regionJarField.setText(prod.getRegional().getJarFile());
        cusCon = prod.getCustomContainer();
        repoBaseDirField.setText(Kernel.settings.getString(Settings.REPOSITORIES_BASE));
        usingRepoBaseDir.setText("Repositories base dir will "
                + ((repoBaseDirField.getText().trim().length() > 0) ? "" : "NOT")
                + " be used");
        cvsImportOriginalField.setText(prod.getCVSImportOriginalPath());
        cvsImpExpTranslationField.setText(prod.getCVSImpExpTranslationPath());
        justLocaleAbCDCheck.setSelected(prod.isOnlyLocaleAbCD());
        
        typeJarRadio.setSelected(isJarBased);
        typeCvsRadio.setSelected(!isJarBased);
        enableJarPanelFields(isJarBased);
        setVisible(true);
        
        if (okay) {
            // set the new parameters
            prod.setName(basicNameField.getText());
            prod.getNeutralPlatform().setJarFile(neutralJarfileField.getText());
            prod.getRegional().setJarFile(regionJarField.getText());
            prod.setCVSImportOriginalPath(cvsImportOriginalField.getText());
            prod.setCVSImpExpTranslationPath(cvsImpExpTranslationField.getText());
            prod.setOnlyLocaleAbCD(justLocaleAbCDCheck.isSelected());
        }
        dispose();
        return okay;
    }

    private boolean validateFields() {
        StringBuilder textValidationResult = new StringBuilder();
        boolean result = true;
        File dummy;

        if (basicNameField.getText().trim().length() == 0) {
            result = false;
            textValidationResult.append("- The product name can't be empty\n");
        }

        if (typeJarRadio.isSelected()) {
            if (neutralJarfileField.getText().trim().length() == 0) {
                textValidationResult.append("- At least the neutral JAR file must be defined\n");
                result = false;
            }
            dummy = new File(neutralJarfileField.getText());
            if (!(dummy.exists() && dummy.isFile())) {
                textValidationResult.append("- The neutral JAR file must exist\n");
                result = false;
            }
        } else {
            dummy = new File(repoBaseDirField.getText() + File.separator + cvsImportOriginalField.getText());
            if (!(dummy.exists() && dummy.isDirectory())) {
                textValidationResult.append("- The Import Original path does not point to a valid directory\n");
                result = false;
            }
            dummy = new File(repoBaseDirField.getText() + File.separator + cvsImpExpTranslationField.getText());
            if (!(dummy.exists() && dummy.isDirectory())) {
                textValidationResult.append("- The Import/Export Translation path does not point to a valid directory\n");
                result = false;
            }
        }

        if (!result) {
            JOptionPane.showMessageDialog(this, textValidationResult.toString(), "Error in " + prod.getName()
                    + " product definition", JOptionPane.ERROR_MESSAGE);
        }
        return result;
    }
     
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField basicNameField;
    private javax.swing.JPanel basicPanel;
    private javax.swing.JPanel buttonPanel;
    private javax.swing.JButton cancelButton;
    private javax.swing.JButton customAddButton;
    private javax.swing.JButton customEditButton;
    private javax.swing.JLabel customFilesLabel;
    private javax.swing.JScrollPane customListScroll;
    private javax.swing.JButton customRemoveButton;
    private javax.swing.JList custom_customList;
    private javax.swing.JTextField cvsImpExpTranslationField;
    private javax.swing.JButton cvsImpExpTranslationFilechoose;
    private javax.swing.JLabel cvsImpExpTranslationLabel;
    private javax.swing.JTextField cvsImportOriginalField;
    private javax.swing.JButton cvsImportOriginalFilechoose;
    private javax.swing.JLabel cvsImportOriginalLabel;
    private javax.swing.JPanel cvsPanel;
    private javax.swing.JPanel jarPanel;
    private javax.swing.JCheckBox justLocaleAbCDCheck;
    private javax.swing.JLabel nameLabel;
    private javax.swing.JTextField neutralJarfileField;
    private javax.swing.JButton neutralJarfileFilechose;
    private javax.swing.JLabel neutralJarfileLabel;
    private javax.swing.JButton okButton;
    private javax.swing.JButton platformAddButton;
    private javax.swing.JButton platformEditButton;
    private javax.swing.JScrollPane platformListScroll;
    private javax.swing.JLabel platformPlatformLabel;
    private javax.swing.JButton platformRemoveButton;
    private javax.swing.JList platform_platformList;
    private javax.swing.JPanel prodPropPanel;
    private javax.swing.JPanel productPanel;
    private javax.swing.ButtonGroup productTypeRG;
    private javax.swing.JTextField regionJarField;
    private javax.swing.JLabel regionJarLabel;
    private javax.swing.JButton regionRegioncChoose;
    private javax.swing.JTextField repoBaseDirField;
    private javax.swing.JRadioButton typeCvsRadio;
    private javax.swing.JRadioButton typeJarRadio;
    private javax.swing.JLabel usingRepoBaseDir;
    // End of variables declaration//GEN-END:variables
    private boolean okay;
    private CustomContainer cusCon;
}
